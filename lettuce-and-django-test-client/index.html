<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Basic Page Needs
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta charset="utf-8">
    <title>Lettuce and django test client | blog.danclaudiupop | Software Testing and more</title>
    <meta name="description" content="blog.danclaudiupop, Software Testing and more">
    <meta name="author" content="danclaudiupop">

    <!-- Mobile Specific Metas
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Feeds
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="alternate" href="http://localhost:8000/feeds/all.atom.xml" type="application/atom+xml" title="blog.danclaudiupop Atom Feed" />

    <!-- FONT
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata">

    <!-- CSS
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.css">
    <link rel="stylesheet" href="http://blog.danclaudiupop.com/theme/css/custom.css">
    <link rel="stylesheet" href="http://blog.danclaudiupop.com/theme/css/pygments.css">

    <!-- Scripts
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.js"></script>
    <script>
        $(document).ready(function(){
            $(".container").fitVids();
        });
    </script>

    <!-- Favicon
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <link rel="icon" type="image/png" href="http://blog.danclaudiupop.com/theme/assets/favicon.png">

</head>
<body>

    <!-- Primary Page Layout
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <div class="container">
        <section class="header">
            <img src="http://blog.danclaudiupop.com/theme/assets/stewie.jpg" class="logo">
        </section>
    </div>
    <div class="container">
        <nav class="navbar">
            <div class="container">
                <ul class="navbar-list">
                    <li class="navbar-item"><a href="http://blog.danclaudiupop.com/" class="navbar-link">Posts</a></li>
                    <li class="navbar-item"><a href="http://blog.danclaudiupop.com/about-us.html" class="navbar-link">About</a></li>
                    <li class="navbar-icon">
                        <a href="http://blog.danclaudiupop.com/feeds/all.atom.xml">
                            <i class="fa fa-rss fa-fw fa-2x"></i>
                        </a>
                    </li>
                    <li class="navbar-icon">
                        <a href="https://github.com/danclaudiupop/">
                            <i class="fa fa-github fa-fw fa-2x"></i>
                        </a>
                    </li>
                    <li class="navbar-icon">
                        <a href="https://twitter.com/danclaudiupop">
                            <i class="fa fa-twitter fa-fw fa-2x"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
    <div class="container">
        <section class="post">
            <header class="post-header">
                <h3>Lettuce and django test client</h3>
                <p class="post-meta">
                    Vi 01 februarie 2013 &middot; tagged 
                        <a class="post-category" href="http://blog.danclaudiupop.com/tag/functional.html">functional</a>
                        <a class="post-category" href="http://blog.danclaudiupop.com/tag/lettuce.html">lettuce</a>
                        <a class="post-category" href="http://blog.danclaudiupop.com/tag/django-test-client.html">django test client</a>
                        <a class="post-category" href="http://blog.danclaudiupop.com/tag/selenium.html">selenium</a>
                </p>
            </header>
        </section>
        <section class="post-content">
            <p>When running a functional test, you fire up “browser” and do the &quot;same&quot; actions
as a real user (or API client). There are different “browsers” for testing your
applications, some of them are real, like selenium and some of them are less
real, like django test client. Depending on the context, each of them has its
pros and cons.</p>
<ul class="simple">
<li>django test client is very fast, since you don’t need a browser engine, real
http listening and so on, but JavaScript and/or Ajax views are not tested</li>
<li>selenium is a browser-driving library, opens a real browser and tests
rendered HTML alongside with behavior of Web pages. Write selenium tests for
Ajax, other JS/server interactions.</li>
</ul>
<p>A complete test suite should contain both test types.</p>
<p>Write functional/integration/system (has more names than it needs) tests for
views. Unit testing the view is hard because views have many dependencies
(templates, db, middleware, url routing etc).</p>
<p>You should definitely have django functional tests but chances are you should
have fewer than you have now. See the <a class="reference external" href="https://github.com/kmike/django-webtest">software testing pyramid</a> by Alister Scott which provides
solid approach to automated testing and shows the mix of testing a team should
aim for.</p>
<p><em>Functional tests:</em></p>
<ul class="simple">
<li>test that the whole integrated system works, catch regressions</li>
<li>they tend to be slow</li>
<li>will catch bugs that unit tests will not, but it's harder to debug</li>
<li>write fewer (more unit tests)</li>
</ul>
<p><em>So what can you test with django-test client ?</em></p>
<ul class="simple">
<li>the correct view is executed for a given url</li>
<li>simulate post, get, head, put etc. requests</li>
<li>the returned content has the expected values (you can use beautiful soup,
lxml or html5lib for parsing the content)</li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight"><pre><span class="n">Feature</span><span class="p">:</span> <span class="n">Register</span>
    <span class="n">In</span> <span class="n">order</span> <span class="n">to</span> <span class="n">get</span> <span class="n">access</span> <span class="n">to</span> <span class="n">app</span>
    <span class="n">A</span> <span class="n">user</span> <span class="n">should</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">register</span>


<span class="n">Scenario</span><span class="p">:</span> <span class="n">User</span> <span class="n">registers</span>
    <span class="n">Given</span> <span class="n">I</span> <span class="n">go</span> <span class="n">to</span> <span class="n">the</span> <span class="n">registration</span> <span class="n">page</span>
    <span class="n">When</span> <span class="n">I</span> <span class="n">fill</span> <span class="n">register</span> <span class="n">form</span> <span class="k">with</span><span class="p">:</span>
        <span class="o">|</span> <span class="n">username</span> <span class="o">|</span> <span class="n">email</span>       <span class="o">|</span> <span class="n">password1</span> <span class="o">|</span> <span class="n">password2</span> <span class="o">|</span>
        <span class="o">|</span> <span class="n">danul</span>    <span class="o">|</span> <span class="n">dan</span><span class="nd">@dan.com</span> <span class="o">|</span> <span class="n">test123</span>   <span class="o">|</span> <span class="n">test123</span>   <span class="o">|</span>
    <span class="n">And</span> <span class="n">I</span> <span class="n">submit</span> <span class="n">the</span> <span class="n">data</span>
    <span class="n">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">see</span> <span class="s">&quot;Check your email&quot;</span>
    <span class="n">And</span> <span class="n">I</span> <span class="n">should</span> <span class="n">receive</span> <span class="n">an</span> <span class="n">email</span> <span class="n">at</span> <span class="s">&quot;dan@dan.com&quot;</span> <span class="k">with</span> <span class="n">the</span> <span class="n">subject</span> <span class="s">&quot;Activate your djangoproject.com account - you have 7 days!&quot;</span>
    <span class="n">And</span> <span class="n">I</span> <span class="n">activate</span> <span class="n">the</span> <span class="n">account</span>
    <span class="n">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">see</span> <span class="s">&quot;Congratulations!&quot;</span>
</pre></div>
<div class="highlight"><pre><span class="nd">@step</span><span class="p">(</span><span class="s">u&#39;I go to the register page&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">i_go_to_the_register_page</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">&#39;registration_register&#39;</span><span class="p">))</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">world</span><span class="o">.</span><span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>


<span class="nd">@step</span><span class="p">(</span><span class="s">u&#39;When I fill register form with:&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">when_i_fill_in_user_data_with</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">hashes</span><span class="p">:</span>
        <span class="n">world</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;form&#39;</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="s">&#39;required&#39;</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span>


<span class="nd">@step</span><span class="p">(</span><span class="s">u&#39;And I submit the data&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">and_i_submit_the_data</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
    <span class="n">world</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">reverse</span><span class="p">(</span><span class="s">&#39;registration_register&#39;</span><span class="p">),</span>
        <span class="n">world</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">follow</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    <span class="n">assert_equals</span><span class="p">(</span>
        <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">world</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span> <span class="bp">True</span>
    <span class="p">)</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>


<span class="nd">@step</span><span class="p">(</span><span class="s">u&#39;I should see &quot;(.*)&quot;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">i_should_see</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">expected_response</span><span class="p">):</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="n">expected_text</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;h1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">expected_text</span><span class="p">,</span> <span class="n">expected_response</span><span class="p">)</span>


<span class="nd">@step</span><span class="p">(</span><span class="s">u&#39;And I should receive an email at &quot;([^&quot;]*)&quot; with the subject &quot;([^&quot;]*)&quot;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">i_should_receive_email_with_subject</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">subject</span><span class="p">):</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">address</span><span class="p">)</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span> <span class="n">subject</span><span class="p">)</span>


<span class="nd">@step</span><span class="p">(</span><span class="s">u&#39;And I activate the account&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">and_i_activate_the_account</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
    <span class="n">activation_url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span>
        <span class="s">r&#39;http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+&#39;</span><span class="p">,</span>
        <span class="n">mail</span><span class="o">.</span><span class="n">outbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
    <span class="p">)</span>
    <span class="n">world</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activation_url</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">follow</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">assert_equals</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
<p><strong>What's next ?</strong></p>
<p>Well ... WebTest  :)</p>
<iframe width="420" height="315" src="//www.youtube.com/embed/ickNQcNXiS4" frameborder="0" allowfullscreen></iframe><div class="line-block">
<div class="line"><br /></div>
</div>
<p>Be a good person and write functional tests. Functional testing is something
that every app needs, no testing strategy is complete without high-level tests
to ensure the entire programming system works together.</p>

        </section>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'danclaudiupop';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><footer class="footer">
    &copy; blog.danclaudiupop &ndash;
        Proudly published with <a href="http://blog.getpelican.com/">Pelican</a>
</footer>    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62968573-1', 'auto');
  ga('send', 'pageview');

</script>
    <!-- End Document
    –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
